try{var d3=require("d3")}catch(t){}var rtVis=function(){function t(t){this._config=t,this.activeArea=t.activeArea,this.activeData=t.activeData,this.activeTime=t.activeTime,this.runDate=t.runDate,this._requiredData=Promise.all([t.geoData,t.summaryData,t.r0Data,t.casesInfectionData,t.casesReportData,t.obsCasesData]),this._dataset_ref={R0:{index:2,title:"R"},casesInfection:{index:3,title:"Cases by date of infection"},casesReport:{index:4,title:"Cases by date of report"}},this._subregional_ref={Afghanistan:"https://epiforecasts.io/covid/posts/national/afghanistan/",Brazil:"https://epiforecasts.io/covid/posts/national/brazil/",Colombia:"https://epiforecasts.io/covid/posts/national/colombia/",India:"https://epiforecasts.io/covid/posts/national/india/",Italy:"https://epiforecasts.io/covid/posts/national/italy/",Germany:"https://epiforecasts.io/covid/posts/national/germany/",Russia:"https://epiforecasts.io/covid/posts/national/russia/","United Kingdom":"https://epiforecasts.io/covid/posts/national/united-kingdom/","United States of America":"https://epiforecasts.io/covid/posts/national/united-states/"}}return t.prototype.setupPage=function(e){var a=this._config,n={time7ButtonClick:this.time7ButtonClick.bind(this),time14ButtonClick:this.time14ButtonClick.bind(this),time30ButtonClick:this.time30ButtonClick.bind(this),timeAllButtonClick:this.timeAllButtonClick.bind(this)};this._requiredData.then(function(t){new setup(a).setupLayout(e,n)})},t.prototype.createMap=function(){var e=this._config,a=this.mapClick.bind(this),n=this.dropdownClick.bind(this);this._requiredData.then(function(t){new map(e).setupMap(t[0],t[1],a,n)})},t.prototype.plotRt=function(t){var e=this._config,a=this.activeArea,n=this.activeTime,i=(this._dataset_ref,this.runDate);this.activeData,this._requiredData.then(function(t){new ts(e).plotAllTs(a,n,t,i)})},t.prototype.time7ButtonClick=function(){var e=this._config,a=this.activeArea,n=(this._dataset_ref[this.activeData].index,this._dataset_ref[this.activeData].title,this.runDate);this.activeData,this._requiredData.then(function(t){new ts(e).plotAllTs(a,"7d",t,n)}),this.activeTime="7d"},t.prototype.time14ButtonClick=function(){var e=this._config,a=this.activeArea,n=(this._dataset_ref[this.activeData].index,this._dataset_ref[this.activeData].title,this.runDate);this.activeData,this._requiredData.then(function(t){new ts(e).plotAllTs(a,"14d",t,n)}),this.activeTime="14d"},t.prototype.time30ButtonClick=function(){var e=this._config,a=this.activeArea,n=(this._dataset_ref[this.activeData].index,this._dataset_ref[this.activeData].title,this.runDate);this.activeData,this._requiredData.then(function(t){new ts(e).plotAllTs(a,"30d",t,n)}),this.activeTime="30d"},t.prototype.timeAllButtonClick=function(){var e=this._config,a=this.activeArea,n=(this._dataset_ref[this.activeData].index,this._dataset_ref[this.activeData].title,this.runDate);this.activeData,this._requiredData.then(function(t){new ts(e).plotAllTs(a,"all",t,n)}),this.activeTime="all"},t.prototype.mapClick=function(t){this.activeArea=t.properties.sovereignt;var e=this._config,a=this.activeArea,n=(this._dataset_ref[this.activeData].index,this._dataset_ref[this.activeData].title,this.activeTime),i=this.runDate;this.activeData,this._requiredData.then(function(t){new ts(e).plotAllTs(a,n,t,i)})},t.prototype.dropdownClick=function(t){this.activeArea=t.params.data.text;var e=this._config,a=this.activeArea,n=(this._dataset_ref[this.activeData].index,this._dataset_ref[this.activeData].title,this.activeTime),i=this.runDate;this.activeData,this._requiredData.then(function(t){new ts(e).plotAllTs(a,n,t,i)}),d3.select("#select2-dropdown-container-container").text(this.activeArea)},t}(),__extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(t,e)};return function(t,e){function a(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}}();try{d3=require("d3")}catch(t){}var setup=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.setupLayout=function(t,e){d3.select(t).append("div").attr("class","map-container").attr("id","map-container"),d3.select("#map-container").append("div").attr("class","dropdown-container").attr("id","dropdown-container"),d3.select(t).append("div").attr("class","country-title-container").attr("id","country-title-container"),d3.select(t).append("div").attr("class","r0-title-container").attr("id","r0-title-container"),d3.select(t).append("div").attr("class","r0-ts-container").attr("id","r0-ts-container"),d3.select(t).append("div").attr("class","cases-infection-title-container").attr("id","cases-infection-title-container"),d3.select(t).append("div").attr("class","cases-infection-ts-container").attr("id","cases-infection-ts-container"),d3.select(t).append("div").attr("class","cases-report-title-container").attr("id","cases-report-title-container"),d3.select(t).append("div").attr("class","cases-report-ts-container").attr("id","cases-report-ts-container"),d3.select(t).append("div").attr("class","controls-container").attr("id","controls-container"),d3.select(t).append("div").attr("class","footer"),d3.select(t).append("div").attr("class","download-container").attr("id","download-container"),d3.select("#controls-container").append("div").attr("class","controls-container-legend").attr("id","controls-container-legend"),d3.select("#controls-container").append("div").attr("class","controls-container-time").attr("id","controls-container-time"),d3.select("#controls-container-legend").append("div").style("width","12px").style("height","12px").attr("class","ts-legend-e"),d3.select("#controls-container-legend").append("div").text("Estimate").attr("class","ts-legend-text"),d3.select("#controls-container-legend").append("div").style("width","12px").style("height","12px").attr("class","ts-legend-eb"),d3.select("#controls-container-legend").append("div").text("Estimate based on partial data").attr("class","ts-legend-text"),d3.select("#controls-container-legend").append("div").style("width","12px").style("height","12px").attr("class","ts-legend-f"),d3.select("#controls-container-legend").append("div").text("Forecast").attr("class","ts-legend-text"),d3.select("#controls-container-time").append("button").attr("class","control-button").attr("id","control-allday").text("All").on("click",e.timeAllButtonClick),this.addButtonSpacer("#controls-container-time"),d3.select("#controls-container-time").append("button").attr("class","control-button").attr("id","control-30day").text("Previous Month").on("click",e.time30ButtonClick),this.addButtonSpacer("#controls-container-time"),d3.select("#controls-container-time").append("button").attr("class","control-button").attr("id","control-7day").text("Previous 2 weeks").on("click",e.time14ButtonClick),this.addButtonSpacer("#controls-container-time"),d3.select("#controls-container-time").append("button").attr("class","control-button").attr("id","control-5day").text("Previous 7 Days").on("click",e.time7ButtonClick),d3.select("#download-container").append("div").text("Download data:"),this.addButtonSpacer("#download-container"),d3.select("#download-container").append("a").attr("class","download-button").attr("id","download-r0").text("R").attr("href",this.r0Url).attr("target","_blank"),this.addButtonSpacer("#download-container"),d3.select("#download-container").append("a").attr("class","download-button").attr("id","download-casesInfection").text("Cases by date of infection").attr("href",this.casesInfectionUrl).attr("target","_blank"),this.addButtonSpacer("#download-container"),d3.select("#download-container").append("a").attr("class","download-button").attr("id","download-casesReport").text("Cases by date of report").attr("href",this.casesReportUrl).attr("target","_blank")},t.prototype.addButtonSpacer=function(t){d3.select(t).append("div").attr("class","button-spacer")},t}(rtVis),__extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(t,e)};return function(t,e){function a(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}}();try{d3=require("d3")}catch(t){}var map=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.setupMap=function(t,a,e,n){var i=d3.select("#map-container").append("svg").attr("class","map-svg").style("width","100%").style("height","100%"),r=document.getElementById("map-container").getBoundingClientRect(),o=d3.geoCylindricalStereographic(),s=d3.geoPath().projection(o);console.log(s.bounds(t)),console.log(d3.geoBounds(t));var c=this.calculateScaleCenter(t,r.width,r.height,s);console.log(c);var o=d3.geoCylindricalStereographic().translate([r.width/2,r.height/2]).scale(c.scale).center(c.center),s=d3.geoPath().projection(o),l={Decreasing:"#1170aa","Likely decreasing":"#5fa2ce",Unsure:"#7b848f","Likely increasing":"#fd9e49",Increasing:"#e75f00","No Data":"lightgray"};i.append("g").attr("class","areas").selectAll("path").data(t.features).enter().append("path").attr("class","area-poly").attr("d",s).attr("stroke","white").attr("summary",function(e){try{return a.filter(function(t){return t.Country==e.properties.sovereignt})[0]["Expected change in daily cases"]}catch(t){return"No Data"}}).attr("country-name",function(t){return t.properties.sovereignt}).attr("fill",function(t){return l[d3.select(this).attr("summary")]}).on("mouseover",this.mapMouseIn).on("mouseout",this.mapMouseOut).on("click",e).style("stroke","black").style("stroke-width","0.2px"),this.createLegend(i,r,l);var d=t.features.map(function(t){return t.properties.sovereignt}).filter(this.onlyUnique).sort();$("#dropdown-container").append(".js-example-basic-single").select2({placeholder:"Select a country",data:d}).on("select2:select",n)},t.prototype.mapMouseIn=function(t){d3.select(this).style("stroke","black").style("stroke-width","1.5px")},t.prototype.mapMouseOut=function(t){d3.select(this).style("stroke","black").style("stroke-width","0.5px")},t.prototype.createLegend=function(t,e,a){var n,i=e.width/30,r=e.height/2;for(t.append("rect").attr("x",i).attr("y",r).attr("width",185).attr("height",200).attr("fill","white").attr("stroke","black").attr("stroke-width","0.5px").attr("rx",8),t.append("text").attr("x",6+i).attr("y",20+r).text("Expected change in cases").style("font-size","10pt").style("font-weight","bold"),n=0;n<Object.entries(a).length;n++)t.append("rect").attr("x",6+i).attr("y",r+200/7*(n+1)+5).attr("width",12).attr("height",12).attr("fill",Object.entries(a)[n][1]),t.append("text").attr("x",23+i).attr("y",r+200/7*(n+1)+15).text(Object.entries(a)[n][0]).style("font-size","12")},t.prototype.calculateScaleCenter=function(t,e,a,n){var i=n.bounds(t),r=120/Math.max((i[1][0]-i[0][0])/e,(i[1][1]-i[0][1])/a),o=d3.geoBounds(t);return{scale:r,center:[(o[1][0]+o[0][0])/2,(o[1][1]+o[0][1])/2]}},t.prototype.onlyUnique=function(t,e,a){return a.indexOf(t)===e},t}(rtVis),__extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(t,e)};return function(t,e){function a(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}}();try{d3=require("d3")}catch(t){}var ts=function(a){function t(t){var e=a.call(this,t)||this;return e.margin={top:10,right:30,bottom:30,left:60},e}return __extends(t,a),t.prototype.plotTs=function(i,e,t,a,r,n,o){void 0===n&&(n=void 0),void 0===o&&(o=!1),d3.select("#"+r+"-svg").remove(),d3.select("#"+r+"-tooltip").remove(),i=i.filter(function(t){return t.country==e}),a=a.filter(function(t){return t.region==e});var s=d3.timeParse("%Y-%m-%d"),c=d3.select("#"+r).append("svg").attr("class",r+"-svg").attr("id",r+"-svg").style("width","100%").style("height","100%").append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),l=document.getElementById(r).getBoundingClientRect();l.width=l.width-this.margin.left-this.margin.right,l.height=l.height-this.margin.top-this.margin.bottom;var d,p,u,h,f,y,v,m,g,_,x,w=d3.min(i,function(t){return s(t.date)});"7d"===t?w=new Date(Date.now()-6048e5):"14d"===t?w=new Date(Date.now()-12096e5):"30d"===t&&(w=new Date(Date.now()-2592e6)),i=i.filter(function(t){return s(t.date)>=w}),a=a.filter(function(t){return d3.timeDay.offset(s(t.date),-1)>=w}),0!==i.length?(d=d3.max(i,function(t){return s(t.date)}),p=d3.max(i,function(t){return parseFloat(t.upper_90)}),u=d3.scaleLinear().domain([0,p]).range([l.height,0]),h=d3.scaleTime().domain([w,d]).range([0,l.width]),f=d3.line().x(function(t){return h(s(t.date))}).y(function(t){return u(1)}).curve(d3.curveCardinal),y=i.filter(function(t){return"estimate"==t.type}),v=i.filter(function(t){return"estimate based on partial data"==t.type}),m=i.filter(function(t){return"forecast"==t.type}),g=this.plotHPoly("date","upper_90","lower_90",h,u,s),_=this.plotHPoly("date","upper_50","lower_50",h,u,s),o||c.selectAll("rect").data(a).enter().append("rect").attr("height",function(t,e){return l.height-u(t.confirm)}).attr("y",function(t,e){return u(t.confirm)}).attr("width",function(t){return.8*(h(d3.timeDay.offset(s(t.date),1))-h(s(t.date)))}).attr("x",function(t,e){return h(d3.timeDay.offset(s(t.date),-.5))}).attr("class","cases_bar"),c.append("path").datum(y).attr("d",g).attr("class","poly_90_e"),c.append("path").datum(v).attr("d",g).attr("class","poly_90_eb"),c.append("path").datum(m).attr("d",g).attr("class","poly_90_f"),c.append("path").datum(y).attr("d",_).attr("class","poly_50_e"),c.append("path").datum(v).attr("d",_).attr("class","poly_50_eb"),c.append("path").datum(m).attr("d",_).attr("class","poly_50_f"),o&&c.append("path").datum(i).attr("d",f).attr("class","r0_line").style("stroke","black").style("stroke-dasharray","5,5"),c.append("g").attr("transform","translate(0,"+l.height+")").call(d3.axisBottom(h)).attr("class","r0-xaxis"),c.append("g").call(d3.axisLeft(u)).attr("class","r0-yaxis"),c.append("line").attr("id",r+"-hover-line").attr("x1",20).attr("y1",0).attr("x2",20).attr("y2",l.height).attr("stroke","black").attr("stroke-width","1px").attr("stroke-opacity",0),console.log(n),void 0!==n&&c.append("line").attr("id","run-date-line").attr("x1",h(s(n))).attr("y1",0).attr("x2",h(s(n))).attr("y2",l.height).attr("stroke","lightgrey").style("stroke-dasharray","5,5"),x=d3.select("#"+r).append("div").style("opacity",0).attr("class",r+"-tooltip").attr("id",r+"-tooltip").style("background-color","white").style("border","solid").style("border-width","2px").style("border-radius","5px").style("padding","5px").style("font-size","9pt").style("overflow","visible").style("position","relative").style("display","inline-block"),c.append("rect").attr("class","overlay").attr("width",l.width).attr("height",l.height).on("mousemove",function(){var e=this;d3.select("#"+r+"-hover-line").attr("x1",d3.mouse(this)[0]).attr("x2",d3.mouse(this)[0]);var t=i.filter(function(t){return s(t.date).toDateString()==h.invert(d3.mouse(e)[0]).toDateString()}),a="<b>"+s(t[0].date).toDateString()+"</b><br>50% CI: "+parseFloat(t[0].lower_50)+" to "+parseFloat(t[0].upper_50)+"<br>90% CI: "+parseFloat(t[0].lower_90)+" to "+parseFloat(t[0].upper_90),n=l.width-d3.mouse(this)[0]<80?-70:70;x.html(a).style("left",d3.mouse(this)[0]+n+"px").style("top",d3.mouse(this)[1]-200+"px")}).on("mouseenter",function(t){d3.select("#"+r+"-tooltip").style("opacity",1),d3.select("#"+r+"-hover-line").attr("stroke-opacity",1)}).on("mouseout",function(t){d3.select("#"+r+"-tooltip").style("opacity",0),d3.select("#"+r+"-hover-line").attr("stroke-opacity",0)}).attr("fill-opacity","0")):c.append("text").attr("x",l.width/2).attr("y",l.height/2).text("No data").style("font-size","20px").style("stroke-width",0).style("fill","gray")},t.prototype.plotAllTs=function(t,e,a,n){void 0===n&&(n=void 0);var i=this.preprocessDataSets(t,a);this.tsCountryTitle(t,"country-title-container"),this.plotTs(i[2],t,e,i[5],"r0-ts-container",n,!0),this.tsDataTitle("R","r0-title-container"),this.plotTs(i[3],t,e,i[5],"cases-infection-ts-container",n,!1),this.tsDataTitle("Cases by date of infection","cases-infection-title-container"),this.plotTs(i[4],t,e,i[5],"cases-report-ts-container",n,!1),this.tsDataTitle("Cases by date of report","cases-report-title-container")},t.prototype.preprocessDataSets=function(e,t){var a=d3.timeParse("%Y-%m-%d"),n=t[2].filter(function(t){return t.country==e}),i=t[3].filter(function(t){return t.country==e}),r=t[4].filter(function(t){return t.country==e}),o=t[5].filter(function(t){return t.region==e}),s=d3.max(o,function(t){return parseFloat(t.confirm)}),c=d3.min(i.filter(function(t){return t.upper_90>=10*s}),function(t){return a(t.date)});return void 0!==c&&(n=n.filter(function(t){return a(t.date)<=c}),i=i.filter(function(t){return a(t.date)<=c}),r=r.filter(function(t){return a(t.date)<=c}),o=o.filter(function(t){return a(t.date)<=c})),[t[0],t[1],n,i,r,o]},t.prototype.tsDataTitle=function(t,e){d3.select("#"+e).text(t)},t.prototype.tsCountryTitle=function(t,e){var a=Object.keys(this._subregional_ref).includes(t)?'<a href="'+this._subregional_ref[t]+'" target="_blank" style="font-size:14px;">Detailed estimates available</a>':"";d3.select("#"+e).html(t),d3.select("#"+e).append("div").attr("id","subregional-link").html(a)},t.prototype.plotHPoly=function(e,a,n,i,r,o){return void 0===o&&(o=null),null!==o?d3.area().x(function(t){return i(o(t[e]))}).y0(function(t){return r(t[a])}).y1(function(t){return r(t[n])}):d3.area().x(function(t){return i(t[e])}).y0(function(t){return r(t[a])}).y1(function(t){return r(t[n])})},t}(rtVis);